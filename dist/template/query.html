<script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.0.1/webcomponents-lite.js"></script><link rel="import" href="/public/plugins/grafana-warp10-datasource/template/ace-editor.html"/><query-editor-row class="warp10-query" query-ctrl="ctrl" has-text-edit-mode="true"><div class="gf-form-inline"><gf-form-switch class="gf-form" label="Hide labels" checked="ctrl.target.hideLabels" on-change="ctrl.refresh()"></gf-form-switch><gf-form-switch class="gf-form pull-right" label="WarpScript editor" checked="ctrl.advancedMode"></gf-form-switch><button class="btn btn-secondary full-height" ng-if="!ctrl.advancedMode" ng-click="ctrl._buildQuery()">Build query</button></div><div class="gf-form-inline" ng-show="ctrl.advancedMode"><ace-editor theme="ace/theme/monokai" mode="ace/mode/warpscript" needupdate="{{ ctrl.updateAce }}"><textarea ng-model="ctrl.target.expr" ng-change="ctrl.onChangeInternal()"></textarea></ace-editor></div><div class="gf-form-block" ng-show="!ctrl.advancedMode"><h5>Fetch data</h5><div class="gf-form"><label class="gf-form-label width-10">Read Token</label><input class="gf-form-input" ng-model="ctrl.readToken"/></div><div class="gf-form-inline"><div class="gf-form" style="align-self: flex-start;"><label class="gf-form-label width-10">Metric name</label><input class="gf-form-input width-10" ng-model="ctrl.className"/></div><div class="gf-form-block"><div class="gf-form-inline"><label class="gf-form-label width-6">Labels</label><input class="gf-form-input width-10" placeholder="key" ng-model="ctrl.extraLabelKey"/><input class="gf-form-input width-10" placeholder="value" ng-model="ctrl.extraLabelValue"/><button class="btn btn-success full-height" ng-click="ctrl._addLabel()"><i class="fa fa-plus" aria-hidden="true"></i></button></div><div class="gf-form-inline" style="justify-content: flex-end;" ng-repeat="(key, val) in ctrl.labels"><label class="gf-form-label width-10"> {{ key }}</label><label class="gf-form-label width-10">{{ val }}</label><button class="btn btn-danger full-height" ng-click="ctrl._delLabel(key)"><i class="fa fa-trash" aria-hidden="true"></i></button></div></div></div><h5>Down sampling</h5><div class="gf-form"><label class="gf-form-label width-10 query-keyword">Bucketizer</label><select ng-model="ctrl.bucketizer"><option value="" selected="selected">None</option><option ng-repeat="bucketizer in ctrl.bucketizers" ng-value="'bucketizer.{{ bucketizer }}'">{{ bucketizer }}</option></select><label class="gf-form-label">Bucket count</label><input class="gf-form-input" type="number" step="10" min="10" max="3840" ng-model="ctrl.bucketCount"/></div><h5>Reduce</h5><div class="gf-form-inline"><div class="gf-form"><label class="gf-form-label width-10 query-keyword">Reducer</label><select ng-model="ctrl.reducer"><option value="" selected="selected">None</option><option ng-repeat="reducer in ctrl.reducers" ng-value="'reducer.{{ reducer }}'">{{ reducer }}</option></select></div><div class="gf-form"><label class="gf-form-label">labels</label><input class="gf-form-input width-10" placeholder="label" ng-model="ctrl.extraReducerLabel"/><button class="btn btn-success full-height" ng-click="ctrl._addReducerLabel()"><i class="fa fa-plus" aria-hidden="true"></i></button></div></div><div class="gf-form-inline"><div class="gf-form" ng-repeat="label in ctrl.reducerLabels"><label class="gf-form-label">{{ label }}</label><button class="btn btn-danger btn-small full-height" ng-click="ctrl._delReducerLabel(label)"><i class="fa fa-trash" aria-hidden="true"></i></button></div></div></div></query-editor-row>