{"version":3,"sources":["../../src/ext-language_tools.js"],"names":["window","ace","define","require","exports","module","oop","EventEmitter","lang","Range","Anchor","HashHandler","Tokenizer","comparePoints","SnippetManager","snippetMap","snippetNameMap","implement","getTokenizer","TabstopToken","str","_","stack","substr","test","inFormatString","tabstopId","parseInt","text","escape","ch","$tokenizer","start","regex","onMatch","val","state","length","expectIf","elseBranch","indexOf","changeCase","local","shift","t","unshift","next","token","merge","snippetVar","choices","slice","split","ts","fmtString","splitRegex","exec","guard","fmt","flag","code","splice","formatString","prototype","tokenizeTmSnippet","startState","getLineTokens","tokens","map","x","value","$getDefaultValue","editor","name","i","variables","__","replace","s","session","r","getWordRange","getTextRange","getLine","getCursorPosition","row","column","getUseSoftTabs","getTabSize","getVariableValue","varName","hasOwnProperty","tmStrFormat","re","RegExp","fmtTokens","_self","formatted","arguments","fmtParts","resolveVariables","gChangeCase","toUpperCase","toLowerCase","join","snippet","result","push","skip","gotoNext","processed","i1","insertSnippetForSelection","snippetText","cursor","line","tabString","getTabString","indentString","match","tabstops","forEach","p","id","index","isNested","some","expanding","copyValue","copy","j","lastIndexOf","arg","Math","max","apply","lines","end","range","getSelectionRange","tabstopManager","TabstopManager","selectionId","inVirtualSelectionMode","selection","addTabstops","insertSnippet","self","forEachSelection","keepOrder","tabNext","$getScope","scope","$mode","$id","pop","inlinePhp","c","getState","substring","getActiveScopes","scopes","includeScopes","expandWithTab","options","expandSnippetForSelection","before","after","snippets","findMatchingSnippet","dryRun","doc","removeInLine","replaceBefore","replaceAfter","M__","matchBefore","T__","matchAfter","content","snippetList","startRe","endRe","triggerRe","endTriggerRe","register","wrapRegexp","src","guardedRegexp","opening","addSnippet","old","unregister","tabTrigger","trigger","escapeRegExp","endTrigger","endGuard","Array","isArray","_signal","removeSnippet","nameMap","parseSnippetFile","list","m","JSON","parse","e","key","guardRe","getSnippetByName","call","$onChange","onChange","bind","$onChangeSelection","delayedCall","onChangeSelection","schedule","$onChangeSession","onChangeSession","$onAfterExec","onAfterExec","attach","ranges","$openTabstops","selectedTabstop","on","commands","keyBinding","addKeyboardHandler","keyboardHandler","detach","removeTabstopMarkers","removeListener","removeKeyboardHandler","delta","changeRange","isRemove","action","startRow","endRow","lineDif","colDiff","$inChange","changedOutside","removeRange","updateLinkedFields","hasLinkedRanges","firstNonLinked","linked","snippetManager","original","command","readOnly","lead","anchor","isEmpty","containsLead","contains","containsAnchor","dir","min","selectTabstop","addTabstopMarkers","sel","multiSelect","toSingleRange","clone","addRange","setRange","fromPoints","moveRelative","dest","movePoint","tabstop","markerId","addMarker","removeMarker","bindKeys","ed","changeTracker","setPosition","pos","update","$insertRight","point","diff","importCssString","Editor","expandSnippet","Renderer","VirtualRenderer","event","dom","$singleLineEditor","el","renderer","$maxLines","setHighlightActiveLine","setShowPrintMargin","setShowGutter","setHighlightGutterLine","$mouseHandler","$focusWaitTimout","$highlightTagPending","AcePopup","parentNode","createElement","popup","appendChild","style","display","setStyle","setOption","noop","focus","$isFocused","$cursorLayer","restartTimer","element","opacity","$keepTextAreaAtCursor","highlight","$searchHighlight","clazz","getDocumentPosition","moveToPosition","selectionMarker","stop","lastMouseEvent","hoverMarker","Infinity","setSelectOnHover","y","scrollTop","setRow","setHoverMarker","$pos","getRow","$textLayer","selected","childNodes","config","firstRow","selectedNode","removeCssClass","addCssClass","hideHoverMarker","suppressRedraw","_emit","getHoveredRow","addListener","container","getLength","data","bgTokenizer","$tokenizeRow","caption","last","matchMask","type","className","meta","maxW","$size","scrollerWidth","layerConfig","characterWidth","metaData","$updateOnChange","$computeWidth","screenWidth","$blockScrolling","isOpen","isTopdown","setData","setValue","stringRepeat","getData","clearSelection","moveCursorTo","scrollCursorIntoView","hide","show","lineHeight","topdownOnly","screenHeight","innerHeight","innerWidth","maxH","top","$borderSize","allowTopdown","$maxPixelHeight","bottom","checkForSizeChanges","left","offsetWidth","getTextLeftOffset","$padding","$imageSize","parForEach","array","fn","callback","completed","arLength","err","ID_REGEX","retrievePrecedingIdentifier","buf","reverse","retrieveFollowingIdentifier","getCompletionPrefix","prefix","completers","completer","identifierRegexps","identifierRegex","util","Autocomplete","autoInsert","autoSelect","exactMatch","gatherCompletionsId","blurListener","changeListener","mousedownListener","mousewheelListener","changeTimer","updateCompletions","tooltipTimer","updateDocTooltip","$init","document","body","documentElement","insertMatch","getPopup","openPopup","keepPopupPosition","completions","filtered","setTheme","getTheme","setFontSize","getFontSize","getPixelPosition","base","rect","getBoundingClientRect","offset","scrollLeft","gutterWidth","off","cancel","hideDocTooltip","activated","relatedTarget","nodeName","href","open","activeElement","textInput","getElement","fromTooltip","tooltipNode","goTo","where","filterText","getAllRanges","remove","execCommand","deleteSuffix","gotoPageUp","gotoPageDown","gatherCompletions","getSession","createAnchor","matches","total","getCompletions","results","concat","finished","showPopup","setFilter","_id","detachIfFinished","FilteredList","cancelContextMenu","all","getDocTooltip","docText","docHTML","showDocTooltip","item","margin","pointerEvents","tabIndex","onblur","innerHTML","textContent","right","isFocused","removeChild","startCommand","bindKey","filterCompletions","sort","a","b","score","prev","filter","items","needle","upper","lower","loop","lastIndex","penalty","distance","i2","getWordIndex","textBefore","wordDistance","prefixPos","words","getValue","wordScores","Object","create","currentWord","word","idx","abs","wordScore","wordList","keys","textCompleter","keyWordCompleter","snippetCompleter","escapeHTML","setCompleters","addCompleter","onChangeMode","loadSnippetsForMode","mode","files","loadSnippetFile","modes","snippetFilePath","loadModule","doLiveAutocomplete","hasCompleter","defineOptions","enableBasicAutocompletion","set","addCommand","removeCommand","enableLiveAutocompletion","enableSnippets"],"mappings":"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","file":"ext-language_tools.js","sourcesContent":["window.ace.define(\"ace/snippets\",[\"require\",\"exports\",\"module\",\"ace/lib/oop\",\"ace/lib/event_emitter\",\"ace/lib/lang\",\"ace/range\",\"ace/anchor\",\"ace/keyboard/hash_handler\",\"ace/tokenizer\",\"ace/lib/dom\",\"ace/editor\"], function(require, exports, module) {\n\"use strict\";\nvar oop = require(\"./lib/oop\");\nvar EventEmitter = require(\"./lib/event_emitter\").EventEmitter;\nvar lang = require(\"./lib/lang\");\nvar Range = require(\"./range\").Range;\nvar Anchor = require(\"./anchor\").Anchor;\nvar HashHandler = require(\"./keyboard/hash_handler\").HashHandler;\nvar Tokenizer = require(\"./tokenizer\").Tokenizer;\nvar comparePoints = Range.comparePoints;\n\nvar SnippetManager = function() {\n    this.snippetMap = {};\n    this.snippetNameMap = {};\n};\n\n(function() {\n    oop.implement(this, EventEmitter);\n    \n    this.getTokenizer = function() {\n        function TabstopToken(str, _, stack) {\n            str = str.substr(1);\n            if (/^\\d+$/.test(str) && !stack.inFormatString)\n                return [{tabstopId: parseInt(str, 10)}];\n            return [{text: str}];\n        }\n        function escape(ch) {\n            return \"(?:[^\\\\\\\\\" + ch + \"]|\\\\\\\\.)\";\n        }\n        SnippetManager.$tokenizer = new Tokenizer({\n            start: [\n                {regex: /:/, onMatch: function(val, state, stack) {\n                    if (stack.length && stack[0].expectIf) {\n                        stack[0].expectIf = false;\n                        stack[0].elseBranch = stack[0];\n                        return [stack[0]];\n                    }\n                    return \":\";\n                }},\n                {regex: /\\\\./, onMatch: function(val, state, stack) {\n                    var ch = val[1];\n                    if (ch == \"}\" && stack.length) {\n                        val = ch;\n                    }else if (\"`$\\\\\".indexOf(ch) != -1) {\n                        val = ch;\n                    } else if (stack.inFormatString) {\n                        if (ch == \"n\")\n                            val = \"\\n\";\n                        else if (ch == \"t\")\n                            val = \"\\n\";\n                        else if (\"ulULE\".indexOf(ch) != -1) {\n                            val = {changeCase: ch, local: ch > \"a\"};\n                        }\n                    }\n\n                    return [val];\n                }},\n                {regex: /}/, onMatch: function(val, state, stack) {\n                    return [stack.length ? stack.shift() : val];\n                }},\n                {regex: /\\$(?:\\d+|\\w+)/, onMatch: TabstopToken},\n                {regex: /\\$\\{[\\dA-Z_a-z]+/, onMatch: function(str, state, stack) {\n                    var t = TabstopToken(str.substr(1), state, stack);\n                    stack.unshift(t[0]);\n                    return t;\n                }, next: \"snippetVar\"},\n                {regex: /\\n/, token: \"newline\", merge: false}\n            ],\n            snippetVar: [\n                {regex: \"\\\\|\" + escape(\"\\\\|\") + \"*\\\\|\", onMatch: function(val, state, stack) {\n                    stack[0].choices = val.slice(1, -1).split(\",\");\n                }, next: \"start\"},\n                {regex: \"/(\" + escape(\"/\") + \"+)/(?:(\" + escape(\"/\") + \"*)/)(\\\\w*):?\",\n                 onMatch: function(val, state, stack) {\n                    var ts = stack[0];\n                    ts.fmtString = val;\n\n                    val = this.splitRegex.exec(val);\n                    ts.guard = val[1];\n                    ts.fmt = val[2];\n                    ts.flag = val[3];\n                    return \"\";\n                }, next: \"start\"},\n                {regex: \"`\" + escape(\"`\") + \"*`\", onMatch: function(val, state, stack) {\n                    stack[0].code = val.splice(1, -1);\n                    return \"\";\n                }, next: \"start\"},\n                {regex: \"\\\\?\", onMatch: function(val, state, stack) {\n                    if (stack[0])\n                        stack[0].expectIf = true;\n                }, next: \"start\"},\n                {regex: \"([^:}\\\\\\\\]|\\\\\\\\.)*:?\", token: \"\", next: \"start\"}\n            ],\n            formatString: [\n                {regex: \"/(\" + escape(\"/\") + \"+)/\", token: \"regex\"},\n                {regex: \"\", onMatch: function(val, state, stack) {\n                    stack.inFormatString = true;\n                }, next: \"start\"}\n            ]\n        });\n        SnippetManager.prototype.getTokenizer = function() {\n            return SnippetManager.$tokenizer;\n        };\n        return SnippetManager.$tokenizer;\n    };\n\n    this.tokenizeTmSnippet = function(str, startState) {\n        return this.getTokenizer().getLineTokens(str, startState).tokens.map(function(x) {\n            return x.value || x;\n        });\n    };\n\n    this.$getDefaultValue = function(editor, name) {\n        if (/^[A-Z]\\d+$/.test(name)) {\n            var i = name.substr(1);\n            return (this.variables[name[0] + \"__\"] || {})[i];\n        }\n        if (/^\\d+$/.test(name)) {\n            return (this.variables.__ || {})[name];\n        }\n        name = name.replace(/^TM_/, \"\");\n\n        if (!editor)\n            return;\n        var s = editor.session;\n        switch(name) {\n            case \"CURRENT_WORD\":\n                var r = s.getWordRange();\n            case \"SELECTION\":\n            case \"SELECTED_TEXT\":\n                return s.getTextRange(r);\n            case \"CURRENT_LINE\":\n                return s.getLine(editor.getCursorPosition().row);\n            case \"PREV_LINE\": // not possible in textmate\n                return s.getLine(editor.getCursorPosition().row - 1);\n            case \"LINE_INDEX\":\n                return editor.getCursorPosition().column;\n            case \"LINE_NUMBER\":\n                return editor.getCursorPosition().row + 1;\n            case \"SOFT_TABS\":\n                return s.getUseSoftTabs() ? \"YES\" : \"NO\";\n            case \"TAB_SIZE\":\n                return s.getTabSize();\n            case \"FILENAME\":\n            case \"FILEPATH\":\n                return \"\";\n            case \"FULLNAME\":\n                return \"Ace\";\n        }\n    };\n    this.variables = {};\n    this.getVariableValue = function(editor, varName) {\n        if (this.variables.hasOwnProperty(varName))\n            return this.variables[varName](editor, varName) || \"\";\n        return this.$getDefaultValue(editor, varName) || \"\";\n    };\n    this.tmStrFormat = function(str, ch, editor) {\n        var flag = ch.flag || \"\";\n        var re = ch.guard;\n        re = new RegExp(re, flag.replace(/[^gi]/, \"\"));\n        var fmtTokens = this.tokenizeTmSnippet(ch.fmt, \"formatString\");\n        var _self = this;\n        var formatted = str.replace(re, function() {\n            _self.variables.__ = arguments;\n            var fmtParts = _self.resolveVariables(fmtTokens, editor);\n            var gChangeCase = \"E\";\n            for (var i  = 0; i < fmtParts.length; i++) {\n                var ch = fmtParts[i];\n                if (typeof ch == \"object\") {\n                    fmtParts[i] = \"\";\n                    if (ch.changeCase && ch.local) {\n                        var next = fmtParts[i + 1];\n                        if (next && typeof next == \"string\") {\n                            if (ch.changeCase == \"u\")\n                                fmtParts[i] = next[0].toUpperCase();\n                            else\n                                fmtParts[i] = next[0].toLowerCase();\n                            fmtParts[i + 1] = next.substr(1);\n                        }\n                    } else if (ch.changeCase) {\n                        gChangeCase = ch.changeCase;\n                    }\n                } else if (gChangeCase == \"U\") {\n                    fmtParts[i] = ch.toUpperCase();\n                } else if (gChangeCase == \"L\") {\n                    fmtParts[i] = ch.toLowerCase();\n                }\n            }\n            return fmtParts.join(\"\");\n        });\n        this.variables.__ = null;\n        return formatted;\n    };\n\n    this.resolveVariables = function(snippet, editor) {\n        var result = [];\n        for (var i = 0; i < snippet.length; i++) {\n            var ch = snippet[i];\n            if (typeof ch == \"string\") {\n                result.push(ch);\n            } else if (typeof ch != \"object\") {\n                continue;\n            } else if (ch.skip) {\n                gotoNext(ch);\n            } else if (ch.processed < i) {\n                continue;\n            } else if (ch.text) {\n                var value = this.getVariableValue(editor, ch.text);\n                if (value && ch.fmtString)\n                    value = this.tmStrFormat(value, ch);\n                ch.processed = i;\n                if (ch.expectIf == null) {\n                    if (value) {\n                        result.push(value);\n                        gotoNext(ch);\n                    }\n                } else {\n                    if (value) {\n                        ch.skip = ch.elseBranch;\n                    } else\n                        gotoNext(ch);\n                }\n            } else if (ch.tabstopId != null) {\n                result.push(ch);\n            } else if (ch.changeCase != null) {\n                result.push(ch);\n            }\n        }\n        function gotoNext(ch) {\n            var i1 = snippet.indexOf(ch, i + 1);\n            if (i1 != -1)\n                i = i1;\n        }\n        return result;\n    };\n\n    this.insertSnippetForSelection = function(editor, snippetText) {\n        var cursor = editor.getCursorPosition();\n        var line = editor.session.getLine(cursor.row);\n        var tabString = editor.session.getTabString();\n        var indentString = line.match(/^\\s*/)[0];\n        \n        if (cursor.column < indentString.length)\n            indentString = indentString.slice(0, cursor.column);\n\n        snippetText = snippetText.replace(/\\r/g, \"\");\n        var tokens = this.tokenizeTmSnippet(snippetText);\n        tokens = this.resolveVariables(tokens, editor);\n        tokens = tokens.map(function(x) {\n            if (x == \"\\n\")\n                return x + indentString;\n            if (typeof x == \"string\")\n                return x.replace(/\\t/g, tabString);\n            return x;\n        });\n        var tabstops = [];\n        tokens.forEach(function(p, i) {\n            if (typeof p != \"object\")\n                return;\n            var id = p.tabstopId;\n            var ts = tabstops[id];\n            if (!ts) {\n                ts = tabstops[id] = [];\n                ts.index = id;\n                ts.value = \"\";\n            }\n            if (ts.indexOf(p) !== -1)\n                return;\n            ts.push(p);\n            var i1 = tokens.indexOf(p, i + 1);\n            if (i1 === -1)\n                return;\n\n            var value = tokens.slice(i + 1, i1);\n            var isNested = value.some(function(t) {return typeof t === \"object\"});          \n            if (isNested && !ts.value) {\n                ts.value = value;\n            } else if (value.length && (!ts.value || typeof ts.value !== \"string\")) {\n                ts.value = value.join(\"\");\n            }\n        });\n        tabstops.forEach(function(ts) {ts.length = 0});\n        var expanding = {};\n        function copyValue(val) {\n            var copy = [];\n            for (var i = 0; i < val.length; i++) {\n                var p = val[i];\n                if (typeof p == \"object\") {\n                    if (expanding[p.tabstopId])\n                        continue;\n                    var j = val.lastIndexOf(p, i - 1);\n                    p = copy[j] || {tabstopId: p.tabstopId};\n                }\n                copy[i] = p;\n            }\n            return copy;\n        }\n        for (var i = 0; i < tokens.length; i++) {\n            var p = tokens[i];\n            if (typeof p != \"object\")\n                continue;\n            var id = p.tabstopId;\n            var i1 = tokens.indexOf(p, i + 1);\n            if (expanding[id]) {\n                if (expanding[id] === p)\n                    expanding[id] = null;\n                continue;\n            }\n            \n            var ts = tabstops[id];\n            var arg = typeof ts.value == \"string\" ? [ts.value] : copyValue(ts.value);\n            arg.unshift(i + 1, Math.max(0, i1 - i));\n            arg.push(p);\n            expanding[id] = p;\n            tokens.splice.apply(tokens, arg);\n\n            if (ts.indexOf(p) === -1)\n                ts.push(p);\n        }\n        var row = 0, column = 0;\n        var text = \"\";\n        tokens.forEach(function(t) {\n            if (typeof t === \"string\") {\n                var lines = t.split(\"\\n\");\n                if (lines.length > 1){\n                    column = lines[lines.length - 1].length;\n                    row += lines.length - 1;\n                } else\n                    column += t.length;\n                text += t;\n            } else {\n                if (!t.start)\n                    t.start = {row: row, column: column};\n                else\n                    t.end = {row: row, column: column};\n            }\n        });\n        var range = editor.getSelectionRange();\n        var end = editor.session.replace(range, text);\n\n        var tabstopManager = new TabstopManager(editor);\n        var selectionId = editor.inVirtualSelectionMode && editor.selection.index;\n        tabstopManager.addTabstops(tabstops, range.start, end, selectionId);\n    };\n    \n    this.insertSnippet = function(editor, snippetText) {\n        var self = this;\n        if (editor.inVirtualSelectionMode)\n            return self.insertSnippetForSelection(editor, snippetText);\n        \n        editor.forEachSelection(function() {\n            self.insertSnippetForSelection(editor, snippetText);\n        }, null, {keepOrder: true});\n        \n        if (editor.tabstopManager)\n            editor.tabstopManager.tabNext();\n    };\n\n    this.$getScope = function(editor) {\n        var scope = editor.session.$mode.$id || \"\";\n        scope = scope.split(\"/\").pop();\n        if (scope === \"html\" || scope === \"php\") {\n            if (scope === \"php\" && !editor.session.$mode.inlinePhp) \n                scope = \"html\";\n            var c = editor.getCursorPosition();\n            var state = editor.session.getState(c.row);\n            if (typeof state === \"object\") {\n                state = state[0];\n            }\n            if (state.substring) {\n                if (state.substring(0, 3) == \"js-\")\n                    scope = \"javascript\";\n                else if (state.substring(0, 4) == \"css-\")\n                    scope = \"css\";\n                else if (state.substring(0, 4) == \"php-\")\n                    scope = \"php\";\n            }\n        }\n        \n        return scope;\n    };\n\n    this.getActiveScopes = function(editor) {\n        var scope = this.$getScope(editor);\n        var scopes = [scope];\n        var snippetMap = this.snippetMap;\n        if (snippetMap[scope] && snippetMap[scope].includeScopes) {\n            scopes.push.apply(scopes, snippetMap[scope].includeScopes);\n        }\n        scopes.push(\"_\");\n        return scopes;\n    };\n\n    this.expandWithTab = function(editor, options) {\n        var self = this;\n        var result = editor.forEachSelection(function() {\n            return self.expandSnippetForSelection(editor, options);\n        }, null, {keepOrder: true});\n        if (result && editor.tabstopManager)\n            editor.tabstopManager.tabNext();\n        return result;\n    };\n    \n    this.expandSnippetForSelection = function(editor, options) {\n        var cursor = editor.getCursorPosition();\n        var line = editor.session.getLine(cursor.row);\n        var before = line.substring(0, cursor.column);\n        var after = line.substr(cursor.column);\n\n        var snippetMap = this.snippetMap;\n        var snippet;\n        this.getActiveScopes(editor).some(function(scope) {\n            var snippets = snippetMap[scope];\n            if (snippets)\n                snippet = this.findMatchingSnippet(snippets, before, after);\n            return !!snippet;\n        }, this);\n        if (!snippet)\n            return false;\n        if (options && options.dryRun)\n            return true;\n        editor.session.doc.removeInLine(cursor.row,\n            cursor.column - snippet.replaceBefore.length,\n            cursor.column + snippet.replaceAfter.length\n        );\n\n        this.variables.M__ = snippet.matchBefore;\n        this.variables.T__ = snippet.matchAfter;\n        this.insertSnippetForSelection(editor, snippet.content);\n\n        this.variables.M__ = this.variables.T__ = null;\n        return true;\n    };\n\n    this.findMatchingSnippet = function(snippetList, before, after) {\n        for (var i = snippetList.length; i--;) {\n            var s = snippetList[i];\n            if (s.startRe && !s.startRe.test(before))\n                continue;\n            if (s.endRe && !s.endRe.test(after))\n                continue;\n            if (!s.startRe && !s.endRe)\n                continue;\n\n            s.matchBefore = s.startRe ? s.startRe.exec(before) : [\"\"];\n            s.matchAfter = s.endRe ? s.endRe.exec(after) : [\"\"];\n            s.replaceBefore = s.triggerRe ? s.triggerRe.exec(before)[0] : \"\";\n            s.replaceAfter = s.endTriggerRe ? s.endTriggerRe.exec(after)[0] : \"\";\n            return s;\n        }\n    };\n\n    this.snippetMap = {};\n    this.snippetNameMap = {};\n    this.register = function(snippets, scope) {\n        var snippetMap = this.snippetMap;\n        var snippetNameMap = this.snippetNameMap;\n        var self = this;\n        \n        if (!snippets) \n            snippets = [];\n        \n        function wrapRegexp(src) {\n            if (src && !/^\\^?\\(.*\\)\\$?$|^\\\\b$/.test(src))\n                src = \"(?:\" + src + \")\";\n\n            return src || \"\";\n        }\n        function guardedRegexp(re, guard, opening) {\n            re = wrapRegexp(re);\n            guard = wrapRegexp(guard);\n            if (opening) {\n                re = guard + re;\n                if (re && re[re.length - 1] != \"$\")\n                    re = re + \"$\";\n            } else {\n                re = re + guard;\n                if (re && re[0] != \"^\")\n                    re = \"^\" + re;\n            }\n            return new RegExp(re);\n        }\n\n        function addSnippet(s) {\n            if (!s.scope)\n                s.scope = scope || \"_\";\n            scope = s.scope;\n            if (!snippetMap[scope]) {\n                snippetMap[scope] = [];\n                snippetNameMap[scope] = {};\n            }\n\n            var map = snippetNameMap[scope];\n            if (s.name) {\n                var old = map[s.name];\n                if (old)\n                    self.unregister(old);\n                map[s.name] = s;\n            }\n            snippetMap[scope].push(s);\n\n            if (s.tabTrigger && !s.trigger) {\n                if (!s.guard && /^\\w/.test(s.tabTrigger))\n                    s.guard = \"\\\\b\";\n                s.trigger = lang.escapeRegExp(s.tabTrigger);\n            }\n            \n            if (!s.trigger && !s.guard && !s.endTrigger && !s.endGuard)\n                return;\n            \n            s.startRe = guardedRegexp(s.trigger, s.guard, true);\n            s.triggerRe = new RegExp(s.trigger, \"\", true);\n\n            s.endRe = guardedRegexp(s.endTrigger, s.endGuard, true);\n            s.endTriggerRe = new RegExp(s.endTrigger, \"\", true);\n        }\n\n        if (snippets && snippets.content)\n            addSnippet(snippets);\n        else if (Array.isArray(snippets))\n            snippets.forEach(addSnippet);\n        \n        this._signal(\"registerSnippets\", {scope: scope});\n    };\n    this.unregister = function(snippets, scope) {\n        var snippetMap = this.snippetMap;\n        var snippetNameMap = this.snippetNameMap;\n\n        function removeSnippet(s) {\n            var nameMap = snippetNameMap[s.scope||scope];\n            if (nameMap && nameMap[s.name]) {\n                delete nameMap[s.name];\n                var map = snippetMap[s.scope||scope];\n                var i = map && map.indexOf(s);\n                if (i >= 0)\n                    map.splice(i, 1);\n            }\n        }\n        if (snippets.content)\n            removeSnippet(snippets);\n        else if (Array.isArray(snippets))\n            snippets.forEach(removeSnippet);\n    };\n    this.parseSnippetFile = function(str) {\n        str = str.replace(/\\r/g, \"\");\n        var list = [], snippet = {};\n        var re = /^#.*|^({[\\s\\S]*})\\s*$|^(\\S+) (.*)$|^((?:\\n*\\t.*)+)/gm;\n        var m;\n        while (m = re.exec(str)) {\n            if (m[1]) {\n                try {\n                    snippet = JSON.parse(m[1]);\n                    list.push(snippet);\n                } catch (e) {}\n            } if (m[4]) {\n                snippet.content = m[4].replace(/^\\t/gm, \"\");\n                list.push(snippet);\n                snippet = {};\n            } else {\n                var key = m[2], val = m[3];\n                if (key == \"regex\") {\n                    var guardRe = /\\/((?:[^\\/\\\\]|\\\\.)*)|$/g;\n                    snippet.guard = guardRe.exec(val)[1];\n                    snippet.trigger = guardRe.exec(val)[1];\n                    snippet.endTrigger = guardRe.exec(val)[1];\n                    snippet.endGuard = guardRe.exec(val)[1];\n                } else if (key == \"snippet\") {\n                    snippet.tabTrigger = val.match(/^\\S*/)[0];\n                    if (!snippet.name)\n                        snippet.name = val;\n                } else {\n                    snippet[key] = val;\n                }\n            }\n        }\n        return list;\n    };\n    this.getSnippetByName = function(name, editor) {\n        var snippetMap = this.snippetNameMap;\n        var snippet;\n        this.getActiveScopes(editor).some(function(scope) {\n            var snippets = snippetMap[scope];\n            if (snippets)\n                snippet = snippets[name];\n            return !!snippet;\n        }, this);\n        return snippet;\n    };\n\n}).call(SnippetManager.prototype);\n\n\nvar TabstopManager = function(editor) {\n    if (editor.tabstopManager)\n        return editor.tabstopManager;\n    editor.tabstopManager = this;\n    this.$onChange = this.onChange.bind(this);\n    this.$onChangeSelection = lang.delayedCall(this.onChangeSelection.bind(this)).schedule;\n    this.$onChangeSession = this.onChangeSession.bind(this);\n    this.$onAfterExec = this.onAfterExec.bind(this);\n    this.attach(editor);\n};\n(function() {\n    this.attach = function(editor) {\n        this.index = 0;\n        this.ranges = [];\n        this.tabstops = [];\n        this.$openTabstops = null;\n        this.selectedTabstop = null;\n\n        this.editor = editor;\n        this.editor.on(\"change\", this.$onChange);\n        this.editor.on(\"changeSelection\", this.$onChangeSelection);\n        this.editor.on(\"changeSession\", this.$onChangeSession);\n        this.editor.commands.on(\"afterExec\", this.$onAfterExec);\n        this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n    };\n    this.detach = function() {\n        this.tabstops.forEach(this.removeTabstopMarkers, this);\n        this.ranges = null;\n        this.tabstops = null;\n        this.selectedTabstop = null;\n        this.editor.removeListener(\"change\", this.$onChange);\n        this.editor.removeListener(\"changeSelection\", this.$onChangeSelection);\n        this.editor.removeListener(\"changeSession\", this.$onChangeSession);\n        this.editor.commands.removeListener(\"afterExec\", this.$onAfterExec);\n        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);\n        this.editor.tabstopManager = null;\n        this.editor = null;\n    };\n\n    this.onChange = function(delta) {\n        var changeRange = delta;\n        var isRemove = delta.action[0] == \"r\";\n        var start = delta.start;\n        var end = delta.end;\n        var startRow = start.row;\n        var endRow = end.row;\n        var lineDif = endRow - startRow;\n        var colDiff = end.column - start.column;\n\n        if (isRemove) {\n            lineDif = -lineDif;\n            colDiff = -colDiff;\n        }\n        if (!this.$inChange && isRemove) {\n            var ts = this.selectedTabstop;\n            var changedOutside = ts && !ts.some(function(r) {\n                return comparePoints(r.start, start) <= 0 && comparePoints(r.end, end) >= 0;\n            });\n            if (changedOutside)\n                return this.detach();\n        }\n        var ranges = this.ranges;\n        for (var i = 0; i < ranges.length; i++) {\n            var r = ranges[i];\n            if (r.end.row < start.row)\n                continue;\n\n            if (isRemove && comparePoints(start, r.start) < 0 && comparePoints(end, r.end) > 0) {\n                this.removeRange(r);\n                i--;\n                continue;\n            }\n\n            if (r.start.row == startRow && r.start.column > start.column)\n                r.start.column += colDiff;\n            if (r.end.row == startRow && r.end.column >= start.column)\n                r.end.column += colDiff;\n            if (r.start.row >= startRow)\n                r.start.row += lineDif;\n            if (r.end.row >= startRow)\n                r.end.row += lineDif;\n\n            if (comparePoints(r.start, r.end) > 0)\n                this.removeRange(r);\n        }\n        if (!ranges.length)\n            this.detach();\n    };\n    this.updateLinkedFields = function() {\n        var ts = this.selectedTabstop;\n        if (!ts || !ts.hasLinkedRanges)\n            return;\n        this.$inChange = true;\n        var session = this.editor.session;\n        var text = session.getTextRange(ts.firstNonLinked);\n        for (var i = ts.length; i--;) {\n            var range = ts[i];\n            if (!range.linked)\n                continue;\n            var fmt = exports.snippetManager.tmStrFormat(text, range.original);\n            session.replace(range, fmt);\n        }\n        this.$inChange = false;\n    };\n    this.onAfterExec = function(e) {\n        if (e.command && !e.command.readOnly)\n            this.updateLinkedFields();\n    };\n    this.onChangeSelection = function() {\n        if (!this.editor)\n            return;\n        var lead = this.editor.selection.lead;\n        var anchor = this.editor.selection.anchor;\n        var isEmpty = this.editor.selection.isEmpty();\n        for (var i = this.ranges.length; i--;) {\n            if (this.ranges[i].linked)\n                continue;\n            var containsLead = this.ranges[i].contains(lead.row, lead.column);\n            var containsAnchor = isEmpty || this.ranges[i].contains(anchor.row, anchor.column);\n            if (containsLead && containsAnchor)\n                return;\n        }\n        this.detach();\n    };\n    this.onChangeSession = function() {\n        this.detach();\n    };\n    this.tabNext = function(dir) {\n        var max = this.tabstops.length;\n        var index = this.index + (dir || 1);\n        index = Math.min(Math.max(index, 1), max);\n        if (index == max)\n            index = 0;\n        this.selectTabstop(index);\n        if (index === 0)\n            this.detach();\n    };\n    this.selectTabstop = function(index) {\n        this.$openTabstops = null;\n        var ts = this.tabstops[this.index];\n        if (ts)\n            this.addTabstopMarkers(ts);\n        this.index = index;\n        ts = this.tabstops[this.index];\n        if (!ts || !ts.length)\n            return;\n        \n        this.selectedTabstop = ts;\n        if (!this.editor.inVirtualSelectionMode) {        \n            var sel = this.editor.multiSelect;\n            sel.toSingleRange(ts.firstNonLinked.clone());\n            for (var i = ts.length; i--;) {\n                if (ts.hasLinkedRanges && ts[i].linked)\n                    continue;\n                sel.addRange(ts[i].clone(), true);\n            }\n            if (sel.ranges[0])\n                sel.addRange(sel.ranges[0].clone());\n        } else {\n            this.editor.selection.setRange(ts.firstNonLinked);\n        }\n        \n        this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n    };\n    this.addTabstops = function(tabstops, start, end) {\n        if (!this.$openTabstops)\n            this.$openTabstops = [];\n        if (!tabstops[0]) {\n            var p = Range.fromPoints(end, end);\n            moveRelative(p.start, start);\n            moveRelative(p.end, start);\n            tabstops[0] = [p];\n            tabstops[0].index = 0;\n        }\n\n        var i = this.index;\n        var arg = [i + 1, 0];\n        var ranges = this.ranges;\n        tabstops.forEach(function(ts, index) {\n            var dest = this.$openTabstops[index] || ts;\n                \n            for (var i = ts.length; i--;) {\n                var p = ts[i];\n                var range = Range.fromPoints(p.start, p.end || p.start);\n                movePoint(range.start, start);\n                movePoint(range.end, start);\n                range.original = p;\n                range.tabstop = dest;\n                ranges.push(range);\n                if (dest != ts)\n                    dest.unshift(range);\n                else\n                    dest[i] = range;\n                if (p.fmtString) {\n                    range.linked = true;\n                    dest.hasLinkedRanges = true;\n                } else if (!dest.firstNonLinked)\n                    dest.firstNonLinked = range;\n            }\n            if (!dest.firstNonLinked)\n                dest.hasLinkedRanges = false;\n            if (dest === ts) {\n                arg.push(dest);\n                this.$openTabstops[index] = dest;\n            }\n            this.addTabstopMarkers(dest);\n        }, this);\n        \n        if (arg.length > 2) {\n            if (this.tabstops.length)\n                arg.push(arg.splice(2, 1)[0]);\n            this.tabstops.splice.apply(this.tabstops, arg);\n        }\n    };\n\n    this.addTabstopMarkers = function(ts) {\n        var session = this.editor.session;\n        ts.forEach(function(range) {\n            if  (!range.markerId)\n                range.markerId = session.addMarker(range, \"ace_snippet-marker\", \"text\");\n        });\n    };\n    this.removeTabstopMarkers = function(ts) {\n        var session = this.editor.session;\n        ts.forEach(function(range) {\n            session.removeMarker(range.markerId);\n            range.markerId = null;\n        });\n    };\n    this.removeRange = function(range) {\n        var i = range.tabstop.indexOf(range);\n        range.tabstop.splice(i, 1);\n        i = this.ranges.indexOf(range);\n        this.ranges.splice(i, 1);\n        this.editor.session.removeMarker(range.markerId);\n        if (!range.tabstop.length) {\n            i = this.tabstops.indexOf(range.tabstop);\n            if (i != -1)\n                this.tabstops.splice(i, 1);\n            if (!this.tabstops.length)\n                this.detach();\n        }\n    };\n\n    this.keyboardHandler = new HashHandler();\n    this.keyboardHandler.bindKeys({\n        \"Tab\": function(ed) {\n            if (exports.snippetManager && exports.snippetManager.expandWithTab(ed)) {\n                return;\n            }\n\n            ed.tabstopManager.tabNext(1);\n        },\n        \"Shift-Tab\": function(ed) {\n            ed.tabstopManager.tabNext(-1);\n        },\n        \"Esc\": function(ed) {\n            ed.tabstopManager.detach();\n        },\n        \"Return\": function(ed) {\n            return false;\n        }\n    });\n}).call(TabstopManager.prototype);\n\n\n\nvar changeTracker = {};\nchangeTracker.onChange = Anchor.prototype.onChange;\nchangeTracker.setPosition = function(row, column) {\n    this.pos.row = row;\n    this.pos.column = column;\n};\nchangeTracker.update = function(pos, delta, $insertRight) {\n    this.$insertRight = $insertRight;\n    this.pos = pos; \n    this.onChange(delta);\n};\n\nvar movePoint = function(point, diff) {\n    if (point.row == 0)\n        point.column += diff.column;\n    point.row += diff.row;\n};\n\nvar moveRelative = function(point, start) {\n    if (point.row == start.row)\n        point.column -= start.column;\n    point.row -= start.row;\n};\n\n\nrequire(\"./lib/dom\").importCssString(\"\\\n.ace_snippet-marker {\\\n    -moz-box-sizing: border-box;\\\n    box-sizing: border-box;\\\n    background: rgba(194, 193, 208, 0.09);\\\n    border: 1px dotted rgba(211, 208, 235, 0.62);\\\n    position: absolute;\\\n}\");\n\nexports.snippetManager = new SnippetManager();\n\n\nvar Editor = require(\"./editor\").Editor;\n(function() {\n    this.insertSnippet = function(content, options) {\n        return exports.snippetManager.insertSnippet(this, content, options);\n    };\n    this.expandSnippet = function(options) {\n        return exports.snippetManager.expandWithTab(this, options);\n    };\n}).call(Editor.prototype);\n\n});\n\ndefine(\"ace/autocomplete/popup\",[\"require\",\"exports\",\"module\",\"ace/virtual_renderer\",\"ace/editor\",\"ace/range\",\"ace/lib/event\",\"ace/lib/lang\",\"ace/lib/dom\"], function(require, exports, module) {\n\"use strict\";\n\nvar Renderer = require(\"../virtual_renderer\").VirtualRenderer;\nvar Editor = require(\"../editor\").Editor;\nvar Range = require(\"../range\").Range;\nvar event = require(\"../lib/event\");\nvar lang = require(\"../lib/lang\");\nvar dom = require(\"../lib/dom\");\n\nvar $singleLineEditor = function(el) {\n    var renderer = new Renderer(el);\n\n    renderer.$maxLines = 4;\n\n    var editor = new Editor(renderer);\n\n    editor.setHighlightActiveLine(false);\n    editor.setShowPrintMargin(false);\n    editor.renderer.setShowGutter(false);\n    editor.renderer.setHighlightGutterLine(false);\n\n    editor.$mouseHandler.$focusWaitTimout = 0;\n    editor.$highlightTagPending = true;\n\n    return editor;\n};\n\nvar AcePopup = function(parentNode) {\n    var el = dom.createElement(\"div\");\n    var popup = new $singleLineEditor(el);\n\n    if (parentNode)\n        parentNode.appendChild(el);\n    el.style.display = \"none\";\n    popup.renderer.content.style.cursor = \"default\";\n    popup.renderer.setStyle(\"ace_autocomplete\");\n\n    popup.setOption(\"displayIndentGuides\", false);\n    popup.setOption(\"dragDelay\", 150);\n\n    var noop = function(){};\n\n    popup.focus = noop;\n    popup.$isFocused = true;\n\n    popup.renderer.$cursorLayer.restartTimer = noop;\n    popup.renderer.$cursorLayer.element.style.opacity = 0;\n\n    popup.renderer.$maxLines = 8;\n    popup.renderer.$keepTextAreaAtCursor = false;\n\n    popup.setHighlightActiveLine(false);\n    popup.session.highlight(\"\");\n    popup.session.$searchHighlight.clazz = \"ace_highlight-marker\";\n\n    popup.on(\"mousedown\", function(e) {\n        var pos = e.getDocumentPosition();\n        popup.selection.moveToPosition(pos);\n        selectionMarker.start.row = selectionMarker.end.row = pos.row;\n        e.stop();\n    });\n\n    var lastMouseEvent;\n    var hoverMarker = new Range(-1,0,-1,Infinity);\n    var selectionMarker = new Range(-1,0,-1,Infinity);\n    selectionMarker.id = popup.session.addMarker(selectionMarker, \"ace_active-line\", \"fullLine\");\n    popup.setSelectOnHover = function(val) {\n        if (!val) {\n            hoverMarker.id = popup.session.addMarker(hoverMarker, \"ace_line-hover\", \"fullLine\");\n        } else if (hoverMarker.id) {\n            popup.session.removeMarker(hoverMarker.id);\n            hoverMarker.id = null;\n        }\n    };\n    popup.setSelectOnHover(false);\n    popup.on(\"mousemove\", function(e) {\n        if (!lastMouseEvent) {\n            lastMouseEvent = e;\n            return;\n        }\n        if (lastMouseEvent.x == e.x && lastMouseEvent.y == e.y) {\n            return;\n        }\n        lastMouseEvent = e;\n        lastMouseEvent.scrollTop = popup.renderer.scrollTop;\n        var row = lastMouseEvent.getDocumentPosition().row;\n        if (hoverMarker.start.row != row) {\n            if (!hoverMarker.id)\n                popup.setRow(row);\n            setHoverMarker(row);\n        }\n    });\n    popup.renderer.on(\"beforeRender\", function() {\n        if (lastMouseEvent && hoverMarker.start.row != -1) {\n            lastMouseEvent.$pos = null;\n            var row = lastMouseEvent.getDocumentPosition().row;\n            if (!hoverMarker.id)\n                popup.setRow(row);\n            setHoverMarker(row, true);\n        }\n    });\n    popup.renderer.on(\"afterRender\", function() {\n        var row = popup.getRow();\n        var t = popup.renderer.$textLayer;\n        var selected = t.element.childNodes[row - t.config.firstRow];\n        if (selected == t.selectedNode)\n            return;\n        if (t.selectedNode)\n            dom.removeCssClass(t.selectedNode, \"ace_selected\");\n        t.selectedNode = selected;\n        if (selected)\n            dom.addCssClass(selected, \"ace_selected\");\n    });\n    var hideHoverMarker = function() { setHoverMarker(-1) };\n    var setHoverMarker = function(row, suppressRedraw) {\n        if (row !== hoverMarker.start.row) {\n            hoverMarker.start.row = hoverMarker.end.row = row;\n            if (!suppressRedraw)\n                popup.session._emit(\"changeBackMarker\");\n            popup._emit(\"changeHoverMarker\");\n        }\n    };\n    popup.getHoveredRow = function() {\n        return hoverMarker.start.row;\n    };\n\n    event.addListener(popup.container, \"mouseout\", hideHoverMarker);\n    popup.on(\"hide\", hideHoverMarker);\n    popup.on(\"changeSelection\", hideHoverMarker);\n\n    popup.session.doc.getLength = function() {\n        return popup.data.length;\n    };\n    popup.session.doc.getLine = function(i) {\n        var data = popup.data[i];\n        if (typeof data == \"string\")\n            return data;\n        return (data && data.value) || \"\";\n    };\n\n    var bgTokenizer = popup.session.bgTokenizer;\n    bgTokenizer.$tokenizeRow = function(row) {\n        var data = popup.data[row];\n        var tokens = [];\n        if (!data)\n            return tokens;\n        if (typeof data == \"string\")\n            data = {value: data};\n        if (!data.caption)\n            data.caption = data.value || data.name;\n\n        var last = -1;\n        var flag, c;\n        for (var i = 0; i < data.caption.length; i++) {\n            c = data.caption[i];\n            flag = data.matchMask & (1 << i) ? 1 : 0;\n            if (last !== flag) {\n                tokens.push({type: data.className || \"\" + ( flag ? \"completion-highlight\" : \"\"), value: c});\n                last = flag;\n            } else {\n                tokens[tokens.length - 1].value += c;\n            }\n        }\n\n        if (data.meta) {\n            var maxW = popup.renderer.$size.scrollerWidth / popup.renderer.layerConfig.characterWidth;\n            var metaData = data.meta;\n            if (metaData.length + data.caption.length > maxW - 2) {\n                metaData = metaData.substr(0, maxW - data.caption.length - 3) + \"\\u2026\"\n            }\n            tokens.push({type: \"rightAlignedText\", value: metaData});\n        }\n        return tokens;\n    };\n    bgTokenizer.$updateOnChange = noop;\n    bgTokenizer.start = noop;\n\n    popup.session.$computeWidth = function() {\n        return this.screenWidth = 0;\n    };\n\n    popup.$blockScrolling = Infinity;\n    popup.isOpen = false;\n    popup.isTopdown = false;\n\n    popup.data = [];\n    popup.setData = function(list) {\n        popup.setValue(lang.stringRepeat(\"\\n\", list.length), -1);\n        popup.data = list || [];\n        popup.setRow(0);\n    };\n    popup.getData = function(row) {\n        return popup.data[row];\n    };\n\n    popup.getRow = function() {\n        return selectionMarker.start.row;\n    };\n    popup.setRow = function(line) {\n        line = Math.max(0, Math.min(this.data.length, line));\n        if (selectionMarker.start.row != line) {\n            popup.selection.clearSelection();\n            selectionMarker.start.row = selectionMarker.end.row = line || 0;\n            popup.session._emit(\"changeBackMarker\");\n            popup.moveCursorTo(line || 0, 0);\n            if (popup.isOpen)\n                popup._signal(\"select\");\n        }\n    };\n\n    popup.on(\"changeSelection\", function() {\n        if (popup.isOpen)\n            popup.setRow(popup.selection.lead.row);\n        popup.renderer.scrollCursorIntoView();\n    });\n\n    popup.hide = function() {\n        this.container.style.display = \"none\";\n        this._signal(\"hide\");\n        popup.isOpen = false;\n    };\n    popup.show = function(pos, lineHeight, topdownOnly) {\n        var el = this.container;\n        var screenHeight = window.innerHeight;\n        var screenWidth = window.innerWidth;\n        var renderer = this.renderer;\n        var maxH = renderer.$maxLines * lineHeight * 1.4;\n        var top = pos.top + this.$borderSize;\n        var allowTopdown = top > screenHeight / 2 && !topdownOnly;\n        if (allowTopdown && top + lineHeight + maxH > screenHeight) {\n            renderer.$maxPixelHeight = top - 2 * this.$borderSize;\n            el.style.top = \"\";\n            el.style.bottom = screenHeight - top + \"px\";\n            popup.isTopdown = false;\n        } else {\n            top += lineHeight;\n            renderer.$maxPixelHeight = screenHeight - top - 0.2 * lineHeight;\n            el.style.top = top + \"px\";\n            el.style.bottom = \"\";\n            popup.isTopdown = true;\n        }\n\n        el.style.display = \"\";\n        this.renderer.$textLayer.checkForSizeChanges();\n\n        var left = pos.left;\n        if (left + el.offsetWidth > screenWidth)\n            left = screenWidth - el.offsetWidth;\n\n        el.style.left = left + \"px\";\n\n        this._signal(\"show\");\n        lastMouseEvent = null;\n        popup.isOpen = true;\n    };\n\n    popup.getTextLeftOffset = function() {\n        return this.$borderSize + this.renderer.$padding + this.$imageSize;\n    };\n\n    popup.$imageSize = 0;\n    popup.$borderSize = 1;\n\n    return popup;\n};\n\ndom.importCssString(\"\\\n.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {\\\n    background-color: #CAD6FA;\\\n    z-index: 1;\\\n}\\\n.ace_editor.ace_autocomplete .ace_line-hover {\\\n    border: 1px solid #abbffe;\\\n    margin-top: -1px;\\\n    background: rgba(233,233,253,0.4);\\\n}\\\n.ace_editor.ace_autocomplete .ace_line-hover {\\\n    position: absolute;\\\n    z-index: 2;\\\n}\\\n.ace_editor.ace_autocomplete .ace_scroller {\\\n   background: none;\\\n   border: none;\\\n   box-shadow: none;\\\n}\\\n.ace_rightAlignedText {\\\n    color: gray;\\\n    display: inline-block;\\\n    position: absolute;\\\n    right: 4px;\\\n    text-align: right;\\\n    z-index: -1;\\\n}\\\n.ace_editor.ace_autocomplete .ace_completion-highlight{\\\n    color: #000;\\\n    text-shadow: 0 0 0.01em;\\\n}\\\n.ace_editor.ace_autocomplete {\\\n    width: 280px;\\\n    z-index: 200000;\\\n    background: #fbfbfb;\\\n    color: #444;\\\n    border: 1px lightgray solid;\\\n    position: fixed;\\\n    box-shadow: 2px 3px 5px rgba(0,0,0,.2);\\\n    line-height: 1.4;\\\n}\");\n\nexports.AcePopup = AcePopup;\n\n});\n\ndefine(\"ace/autocomplete/util\",[\"require\",\"exports\",\"module\"], function(require, exports, module) {\n\"use strict\";\n\nexports.parForEach = function(array, fn, callback) {\n    var completed = 0;\n    var arLength = array.length;\n    if (arLength === 0)\n        callback();\n    for (var i = 0; i < arLength; i++) {\n        fn(array[i], function(result, err) {\n            completed++;\n            if (completed === arLength)\n                callback(result, err);\n        });\n    }\n};\n\nvar ID_REGEX = /[a-zA-Z_0-9\\$\\-\\u00A2-\\uFFFF]/;\n\nexports.retrievePrecedingIdentifier = function(text, pos, regex) {\n    regex = regex || ID_REGEX;\n    var buf = [];\n    for (var i = pos-1; i >= 0; i--) {\n        if (regex.test(text[i]))\n            buf.push(text[i]);\n        else\n            break;\n    }\n    return buf.reverse().join(\"\");\n};\n\nexports.retrieveFollowingIdentifier = function(text, pos, regex) {\n    regex = regex || ID_REGEX;\n    var buf = [];\n    for (var i = pos; i < text.length; i++) {\n        if (regex.test(text[i]))\n            buf.push(text[i]);\n        else\n            break;\n    }\n    return buf;\n};\n\nexports.getCompletionPrefix = function (editor) {\n    var pos = editor.getCursorPosition();\n    var line = editor.session.getLine(pos.row);\n    var prefix;\n    editor.completers.forEach(function(completer) {\n        if (completer.identifierRegexps) {\n            completer.identifierRegexps.forEach(function(identifierRegex) {\n                if (!prefix && identifierRegex)\n                    prefix = this.retrievePrecedingIdentifier(line, pos.column, identifierRegex);\n            }.bind(this));\n        }\n    }.bind(this));\n    return prefix || this.retrievePrecedingIdentifier(line, pos.column);\n};\n\n});\n\ndefine(\"ace/autocomplete\",[\"require\",\"exports\",\"module\",\"ace/keyboard/hash_handler\",\"ace/autocomplete/popup\",\"ace/autocomplete/util\",\"ace/lib/event\",\"ace/lib/lang\",\"ace/lib/dom\",\"ace/snippets\"], function(require, exports, module) {\n\"use strict\";\n\nvar HashHandler = require(\"./keyboard/hash_handler\").HashHandler;\nvar AcePopup = require(\"./autocomplete/popup\").AcePopup;\nvar util = require(\"./autocomplete/util\");\nvar event = require(\"./lib/event\");\nvar lang = require(\"./lib/lang\");\nvar dom = require(\"./lib/dom\");\nvar snippetManager = require(\"./snippets\").snippetManager;\n\nvar Autocomplete = function() {\n    this.autoInsert = false;\n    this.autoSelect = true;\n    this.exactMatch = false;\n    this.gatherCompletionsId = 0;\n    this.keyboardHandler = new HashHandler();\n    this.keyboardHandler.bindKeys(this.commands);\n\n    this.blurListener = this.blurListener.bind(this);\n    this.changeListener = this.changeListener.bind(this);\n    this.mousedownListener = this.mousedownListener.bind(this);\n    this.mousewheelListener = this.mousewheelListener.bind(this);\n\n    this.changeTimer = lang.delayedCall(function() {\n        this.updateCompletions(true);\n    }.bind(this));\n\n    this.tooltipTimer = lang.delayedCall(this.updateDocTooltip.bind(this), 50);\n};\n\n(function() {\n\n    this.$init = function() {\n        this.popup = new AcePopup(document.body || document.documentElement);\n        this.popup.on(\"click\", function(e) {\n            this.insertMatch();\n            e.stop();\n        }.bind(this));\n        this.popup.focus = this.editor.focus.bind(this.editor);\n        this.popup.on(\"show\", this.tooltipTimer.bind(null, null));\n        this.popup.on(\"select\", this.tooltipTimer.bind(null, null));\n        this.popup.on(\"changeHoverMarker\", this.tooltipTimer.bind(null, null));\n        return this.popup;\n    };\n\n    this.getPopup = function() {\n        return this.popup || this.$init();\n    };\n\n    this.openPopup = function(editor, prefix, keepPopupPosition) {\n        if (!this.popup)\n            this.$init();\n\n        this.popup.setData(this.completions.filtered);\n\n        editor.keyBinding.addKeyboardHandler(this.keyboardHandler);\n        \n        var renderer = editor.renderer;\n        this.popup.setRow(this.autoSelect ? 0 : -1);\n        if (!keepPopupPosition) {\n            this.popup.setTheme(editor.getTheme());\n            this.popup.setFontSize(editor.getFontSize());\n\n            var lineHeight = renderer.layerConfig.lineHeight;\n\n            var pos = renderer.$cursorLayer.getPixelPosition(this.base, true);\n            pos.left -= this.popup.getTextLeftOffset();\n\n            var rect = editor.container.getBoundingClientRect();\n            pos.top += rect.top - renderer.layerConfig.offset;\n            pos.left += rect.left - editor.renderer.scrollLeft;\n            pos.left += renderer.gutterWidth;\n\n            this.popup.show(pos, lineHeight);\n        } else if (keepPopupPosition && !prefix) {\n            this.detach();\n        }\n    };\n\n    this.detach = function() {\n        this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler);\n        this.editor.off(\"changeSelection\", this.changeListener);\n        this.editor.off(\"blur\", this.blurListener);\n        this.editor.off(\"mousedown\", this.mousedownListener);\n        this.editor.off(\"mousewheel\", this.mousewheelListener);\n        this.changeTimer.cancel();\n        this.hideDocTooltip();\n\n        this.gatherCompletionsId += 1;\n        if (this.popup && this.popup.isOpen)\n            this.popup.hide();\n\n        if (this.base)\n            this.base.detach();\n        this.activated = false;\n        this.completions = this.base = null;\n    };\n\n    this.changeListener = function(e) {\n        var cursor = this.editor.selection.lead;\n        if (cursor.row != this.base.row || cursor.column < this.base.column) {\n            this.detach();\n        }\n        if (this.activated)\n            this.changeTimer.schedule();\n        else\n            this.detach();\n    };\n\n    this.blurListener = function(e) {\n        if (e.relatedTarget && e.relatedTarget.nodeName == \"A\" && e.relatedTarget.href) {\n            window.open(e.relatedTarget.href, \"_blank\");\n        }\n        var el = document.activeElement;\n        var text = this.editor.textInput.getElement();\n        var fromTooltip = e.relatedTarget && e.relatedTarget == this.tooltipNode;\n        var container = this.popup && this.popup.container;\n        if (el != text && el.parentNode != container && !fromTooltip\n            && el != this.tooltipNode && e.relatedTarget != text\n        ) {\n            this.detach();\n        }\n    };\n\n    this.mousedownListener = function(e) {\n        this.detach();\n    };\n\n    this.mousewheelListener = function(e) {\n        this.detach();\n    };\n\n    this.goTo = function(where) {\n        var row = this.popup.getRow();\n        var max = this.popup.session.getLength() - 1;\n\n        switch(where) {\n            case \"up\": row = row <= 0 ? max : row - 1; break;\n            case \"down\": row = row >= max ? -1 : row + 1; break;\n            case \"start\": row = 0; break;\n            case \"end\": row = max; break;\n        }\n\n        this.popup.setRow(row);\n    };\n\n    this.insertMatch = function(data, options) {\n        if (!data)\n            data = this.popup.getData(this.popup.getRow());\n        if (!data)\n            return false;\n\n        if (data.completer && data.completer.insertMatch) {\n            data.completer.insertMatch(this.editor, data);\n        } else {\n            if (this.completions.filterText) {\n                var ranges = this.editor.selection.getAllRanges();\n                for (var i = 0, range; range = ranges[i]; i++) {\n                    range.start.column -= this.completions.filterText.length;\n                    this.editor.session.remove(range);\n                }\n            }\n            if (data.snippet)\n                snippetManager.insertSnippet(this.editor, data.snippet);\n            else\n                this.editor.execCommand(\"insertstring\", data.value || data);\n        }\n        this.detach();\n    };\n\n\n    this.commands = {\n        \"Up\": function(editor) { editor.completer.goTo(\"up\"); },\n        \"Down\": function(editor) { editor.completer.goTo(\"down\"); },\n        \"Ctrl-Up|Ctrl-Home\": function(editor) { editor.completer.goTo(\"start\"); },\n        \"Ctrl-Down|Ctrl-End\": function(editor) { editor.completer.goTo(\"end\"); },\n\n        \"Esc\": function(editor) { editor.completer.detach(); },\n        \"Return\": function(editor) { return editor.completer.insertMatch(); },\n        \"Shift-Return\": function(editor) { editor.completer.insertMatch(null, {deleteSuffix: true}); },\n        \"Tab\": function(editor) {\n            var result = editor.completer.insertMatch();\n            if (!result && !editor.tabstopManager)\n                editor.completer.goTo(\"down\");\n            else\n                return result;\n        },\n\n        \"PageUp\": function(editor) { editor.completer.popup.gotoPageUp(); },\n        \"PageDown\": function(editor) { editor.completer.popup.gotoPageDown(); }\n    };\n\n    this.gatherCompletions = function(editor, callback) {\n        var session = editor.getSession();\n        var pos = editor.getCursorPosition();\n\n        var line = session.getLine(pos.row);\n        var prefix = util.getCompletionPrefix(editor);\n\n        this.base = session.doc.createAnchor(pos.row, pos.column - prefix.length);\n        this.base.$insertRight = true;\n\n        var matches = [];\n        var total = editor.completers.length;\n        editor.completers.forEach(function(completer, i) {\n            completer.getCompletions(editor, session, pos, prefix, function(err, results) {\n                if (!err && results)\n                    matches = matches.concat(results);\n                var pos = editor.getCursorPosition();\n                var line = session.getLine(pos.row);\n                callback(null, {\n                    prefix: prefix,\n                    matches: matches,\n                    finished: (--total === 0)\n                });\n            });\n        });\n        return true;\n    };\n\n    this.showPopup = function(editor) {\n        if (this.editor)\n            this.detach();\n\n        this.activated = true;\n\n        this.editor = editor;\n        if (editor.completer != this) {\n            if (editor.completer)\n                editor.completer.detach();\n            editor.completer = this;\n        }\n\n        editor.on(\"changeSelection\", this.changeListener);\n        editor.on(\"blur\", this.blurListener);\n        editor.on(\"mousedown\", this.mousedownListener);\n        editor.on(\"mousewheel\", this.mousewheelListener);\n\n        this.updateCompletions();\n    };\n\n    this.updateCompletions = function(keepPopupPosition) {\n        if (keepPopupPosition && this.base && this.completions) {\n            var pos = this.editor.getCursorPosition();\n            var prefix = this.editor.session.getTextRange({start: this.base, end: pos});\n            if (prefix == this.completions.filterText)\n                return;\n            this.completions.setFilter(prefix);\n            if (!this.completions.filtered.length)\n                return this.detach();\n            if (this.completions.filtered.length == 1\n            && this.completions.filtered[0].value == prefix\n            && !this.completions.filtered[0].snippet)\n                return this.detach();\n            this.openPopup(this.editor, prefix, keepPopupPosition);\n            return;\n        }\n        var _id = this.gatherCompletionsId;\n        this.gatherCompletions(this.editor, function(err, results) {\n            var detachIfFinished = function() {\n                if (!results.finished) return;\n                return this.detach();\n            }.bind(this);\n\n            var prefix = results.prefix;\n            var matches = results && results.matches;\n\n            if (!matches || !matches.length)\n                return detachIfFinished();\n            if (prefix.indexOf(results.prefix) !== 0 || _id != this.gatherCompletionsId)\n                return;\n\n            this.completions = new FilteredList(matches);\n\n            if (this.exactMatch)\n                this.completions.exactMatch = true;\n\n            this.completions.setFilter(prefix);\n            var filtered = this.completions.filtered;\n            if (!filtered.length)\n                return detachIfFinished();\n            if (filtered.length == 1 && filtered[0].value == prefix && !filtered[0].snippet)\n                return detachIfFinished();\n            if (this.autoInsert && filtered.length == 1 && results.finished)\n                return this.insertMatch(filtered[0]);\n\n            this.openPopup(this.editor, prefix, keepPopupPosition);\n        }.bind(this));\n    };\n\n    this.cancelContextMenu = function() {\n        this.editor.$mouseHandler.cancelContextMenu();\n    };\n\n    this.updateDocTooltip = function() {\n        var popup = this.popup;\n        var all = popup.data;\n        var selected = all && (all[popup.getHoveredRow()] || all[popup.getRow()]);\n        var doc = null;\n        if (!selected || !this.editor || !this.popup.isOpen)\n            return this.hideDocTooltip();\n        this.editor.completers.some(function(completer) {\n            if (completer.getDocTooltip)\n                doc = completer.getDocTooltip(selected);\n            return doc;\n        });\n        if (!doc)\n            doc = selected;\n\n        if (typeof doc == \"string\")\n            doc = {docText: doc};\n        if (!doc || !(doc.docHTML || doc.docText))\n            return this.hideDocTooltip();\n        this.showDocTooltip(doc);\n    };\n\n    this.showDocTooltip = function(item) {\n        if (!this.tooltipNode) {\n            this.tooltipNode = dom.createElement(\"div\");\n            this.tooltipNode.className = \"ace_tooltip ace_doc-tooltip\";\n            this.tooltipNode.style.margin = 0;\n            this.tooltipNode.style.pointerEvents = \"auto\";\n            this.tooltipNode.tabIndex = -1;\n            this.tooltipNode.onblur = this.blurListener.bind(this);\n        }\n\n        var tooltipNode = this.tooltipNode;\n        if (item.docHTML) {\n            tooltipNode.innerHTML = item.docHTML;\n        } else if (item.docText) {\n            tooltipNode.textContent = item.docText;\n        }\n\n        if (!tooltipNode.parentNode)\n            document.body.appendChild(tooltipNode);\n        var popup = this.popup;\n        var rect = popup.container.getBoundingClientRect();\n        tooltipNode.style.top = popup.container.style.top;\n        tooltipNode.style.bottom = popup.container.style.bottom;\n\n        if (window.innerWidth - rect.right < 320) {\n            tooltipNode.style.right = window.innerWidth - rect.left + \"px\";\n            tooltipNode.style.left = \"\";\n        } else {\n            tooltipNode.style.left = (rect.right + 1) + \"px\";\n            tooltipNode.style.right = \"\";\n        }\n        tooltipNode.style.display = \"block\";\n    };\n\n    this.hideDocTooltip = function() {\n        this.tooltipTimer.cancel();\n        if (!this.tooltipNode) return;\n        var el = this.tooltipNode;\n        if (!this.editor.isFocused() && document.activeElement == el)\n            this.editor.focus();\n        this.tooltipNode = null;\n        if (el.parentNode)\n            el.parentNode.removeChild(el);\n    };\n\n}).call(Autocomplete.prototype);\n\nAutocomplete.startCommand = {\n    name: \"startAutocomplete\",\n    exec: function(editor) {\n        if (!editor.completer)\n            editor.completer = new Autocomplete();\n        editor.completer.autoInsert = false;\n        editor.completer.autoSelect = true;\n        editor.completer.showPopup(editor);\n        editor.completer.cancelContextMenu();\n    },\n    bindKey: \"Ctrl-Space|Ctrl-Shift-Space|Alt-Space\"\n};\n\nvar FilteredList = function(array, filterText) {\n    this.all = array;\n    this.filtered = array;\n    this.filterText = filterText || \"\";\n    this.exactMatch = false;\n};\n(function(){\n    this.setFilter = function(str) {\n        if (str.length > this.filterText && str.lastIndexOf(this.filterText, 0) === 0)\n            var matches = this.filtered;\n        else\n            var matches = this.all;\n\n        this.filterText = str;\n        matches = this.filterCompletions(matches, this.filterText);\n        matches = matches.sort(function(a, b) {\n            return b.exactMatch - a.exactMatch || b.score - a.score;\n        });\n        var prev = null;\n        matches = matches.filter(function(item){\n            var caption = item.snippet || item.caption || item.value;\n            if (caption === prev) return false;\n            prev = caption;\n            return true;\n        });\n\n        this.filtered = matches;\n    };\n    this.filterCompletions = function(items, needle) {\n        var results = [];\n        var upper = needle.toUpperCase();\n        var lower = needle.toLowerCase();\n        loop: for (var i = 0, item; item = items[i]; i++) {\n            var caption = item.value || item.caption || item.snippet;\n            if (!caption) continue;\n            var lastIndex = -1;\n            var matchMask = 0;\n            var penalty = 0;\n            var index, distance;\n\n            if (this.exactMatch) {\n                if (needle !== caption.substr(0, needle.length))\n                    continue loop;\n            }else{\n                for (var j = 0; j < needle.length; j++) {\n                    var i1 = caption.indexOf(lower[j], lastIndex + 1);\n                    var i2 = caption.indexOf(upper[j], lastIndex + 1);\n                    index = (i1 >= 0) ? ((i2 < 0 || i1 < i2) ? i1 : i2) : i2;\n                    if (index < 0)\n                        continue loop;\n                    distance = index - lastIndex - 1;\n                    if (distance > 0) {\n                        if (lastIndex === -1)\n                            penalty += 10;\n                        penalty += distance;\n                    }\n                    matchMask = matchMask | (1 << index);\n                    lastIndex = index;\n                }\n            }\n            item.matchMask = matchMask;\n            item.exactMatch = penalty ? 0 : 1;\n            item.score = (item.score || 0) - penalty;\n            results.push(item);\n        }\n        return results;\n    };\n}).call(FilteredList.prototype);\n\nexports.Autocomplete = Autocomplete;\nexports.FilteredList = FilteredList;\n\n});\n\ndefine(\"ace/autocomplete/text_completer\",[\"require\",\"exports\",\"module\",\"ace/range\"], function(require, exports, module) {\n    var Range = require(\"../range\").Range;\n    \n    var splitRegex = /[^a-zA-Z_0-9\\$\\-\\u00C0-\\u1FFF\\u2C00-\\uD7FF\\w]+/;\n\n    function getWordIndex(doc, pos) {\n        var textBefore = doc.getTextRange(Range.fromPoints({row: 0, column:0}, pos));\n        return textBefore.split(splitRegex).length - 1;\n    }\n    function wordDistance(doc, pos) {\n        var prefixPos = getWordIndex(doc, pos);\n        var words = doc.getValue().split(splitRegex);\n        var wordScores = Object.create(null);\n        \n        var currentWord = words[prefixPos];\n\n        words.forEach(function(word, idx) {\n            if (!word || word === currentWord) return;\n\n            var distance = Math.abs(prefixPos - idx);\n            var score = words.length - distance;\n            if (wordScores[word]) {\n                wordScores[word] = Math.max(score, wordScores[word]);\n            } else {\n                wordScores[word] = score;\n            }\n        });\n        return wordScores;\n    }\n\n    exports.getCompletions = function(editor, session, pos, prefix, callback) {\n        var wordScore = wordDistance(session, pos, prefix);\n        var wordList = Object.keys(wordScore);\n        callback(null, wordList.map(function(word) {\n            return {\n                caption: word,\n                value: word,\n                score: wordScore[word],\n                meta: \"local\"\n            };\n        }));\n    };\n});\n\ndefine(\"ace/ext/language_tools\",[\"require\",\"exports\",\"module\",\"ace/snippets\",\"ace/autocomplete\",\"ace/config\",\"ace/lib/lang\",\"ace/autocomplete/util\",\"ace/autocomplete/text_completer\",\"ace/editor\",\"ace/config\"], function(require, exports, module) {\n\"use strict\";\n\nvar snippetManager = require(\"../snippets\").snippetManager;\nvar Autocomplete = require(\"../autocomplete\").Autocomplete;\nvar config = require(\"../config\");\nvar lang = require(\"../lib/lang\");\nvar util = require(\"../autocomplete/util\");\n\nvar textCompleter = require(\"../autocomplete/text_completer\");\nvar keyWordCompleter = {\n    getCompletions: function(editor, session, pos, prefix, callback) {\n        if (session.$mode.completer) {\n            return session.$mode.completer.getCompletions(editor, session, pos, prefix, callback);\n        }\n        var state = editor.session.getState(pos.row);\n        var completions = session.$mode.getCompletions(state, session, pos, prefix);\n        callback(null, completions);\n    }\n};\n\nvar snippetCompleter = {\n    getCompletions: function(editor, session, pos, prefix, callback) {\n        var snippetMap = snippetManager.snippetMap;\n        var completions = [];\n        snippetManager.getActiveScopes(editor).forEach(function(scope) {\n            var snippets = snippetMap[scope] || [];\n            for (var i = snippets.length; i--;) {\n                var s = snippets[i];\n                var caption = s.name || s.tabTrigger;\n                if (!caption)\n                    continue;\n                completions.push({\n                    caption: caption,\n                    snippet: s.content,\n                    meta: s.tabTrigger && !s.name ? s.tabTrigger + \"\\u21E5 \" : \"snippet\",\n                    type: \"snippet\"\n                });\n            }\n        }, this);\n        callback(null, completions);\n    },\n    getDocTooltip: function(item) {\n        if (item.type == \"snippet\" && !item.docHTML) {\n            item.docHTML = [\n                \"<b>\", lang.escapeHTML(item.caption), \"</b>\", \"<hr></hr>\",\n                lang.escapeHTML(item.snippet)\n            ].join(\"\");\n        }\n    }\n};\n\nvar completers = [snippetCompleter, textCompleter, keyWordCompleter];\nexports.setCompleters = function(val) {\n    completers.length = 0;\n    if (val) completers.push.apply(completers, val);\n};\nexports.addCompleter = function(completer) {\n    completers.push(completer);\n};\nexports.textCompleter = textCompleter;\nexports.keyWordCompleter = keyWordCompleter;\nexports.snippetCompleter = snippetCompleter;\n\nvar expandSnippet = {\n    name: \"expandSnippet\",\n    exec: function(editor) {\n        return snippetManager.expandWithTab(editor);\n    },\n    bindKey: \"Tab\"\n};\n\nvar onChangeMode = function(e, editor) {\n    loadSnippetsForMode(editor.session.$mode);\n};\n\nvar loadSnippetsForMode = function(mode) {\n    var id = mode.$id;\n    if (!snippetManager.files)\n        snippetManager.files = {};\n    loadSnippetFile(id);\n    if (mode.modes)\n        mode.modes.forEach(loadSnippetsForMode);\n};\n\nvar loadSnippetFile = function(id) {\n    if (!id || snippetManager.files[id])\n        return;\n    var snippetFilePath = id.replace(\"mode\", \"snippets\");\n    snippetManager.files[id] = {};\n    config.loadModule(snippetFilePath, function(m) {\n        if (m) {\n            snippetManager.files[id] = m;\n            if (!m.snippets && m.snippetText)\n                m.snippets = snippetManager.parseSnippetFile(m.snippetText);\n            snippetManager.register(m.snippets || [], m.scope);\n            if (m.includeScopes) {\n                snippetManager.snippetMap[m.scope].includeScopes = m.includeScopes;\n                m.includeScopes.forEach(function(x) {\n                    loadSnippetFile(\"ace/mode/\" + x);\n                });\n            }\n        }\n    });\n};\n\nvar doLiveAutocomplete = function(e) {\n    var editor = e.editor;\n    var hasCompleter = editor.completer && editor.completer.activated;\n    if (e.command.name === \"backspace\") {\n        if (hasCompleter && !util.getCompletionPrefix(editor))\n            editor.completer.detach();\n    }\n    else if (e.command.name === \"insertstring\") {\n        var prefix = util.getCompletionPrefix(editor);\n        if (prefix && !hasCompleter) {\n            if (!editor.completer) {\n                editor.completer = new Autocomplete();\n            }\n            editor.completer.autoInsert = false;\n            editor.completer.showPopup(editor);\n        }\n    }\n};\n\nvar Editor = require(\"../editor\").Editor;\nrequire(\"../config\").defineOptions(Editor.prototype, \"editor\", {\n    enableBasicAutocompletion: {\n        set: function(val) {\n            if (val) {\n                if (!this.completers)\n                    this.completers = Array.isArray(val)? val: completers;\n                this.commands.addCommand(Autocomplete.startCommand);\n            } else {\n                this.commands.removeCommand(Autocomplete.startCommand);\n            }\n        },\n        value: false\n    },\n    enableLiveAutocompletion: {\n        set: function(val) {\n            if (val) {\n                if (!this.completers)\n                    this.completers = Array.isArray(val)? val: completers;\n                this.commands.on('afterExec', doLiveAutocomplete);\n            } else {\n                this.commands.removeListener('afterExec', doLiveAutocomplete);\n            }\n        },\n        value: false\n    },\n    enableSnippets: {\n        set: function(val) {\n            if (val) {\n                this.commands.addCommand(expandSnippet);\n                this.on(\"changeMode\", onChangeMode);\n                onChangeMode(null, this);\n            } else {\n                this.commands.removeCommand(expandSnippet);\n                this.off(\"changeMode\", onChangeMode);\n            }\n        },\n        value: false\n    }\n});\n});\n                (function() {\n                    window.require([\"ace/ext/language_tools\"], function() {});\n                })();\n            "]}